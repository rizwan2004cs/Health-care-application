<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Professional Profile - Bizil Health Care</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="signup-container">
        <div class="signup-content">
            <div class="brand-section">
                <div class="brand-logo">
                    <i class="fas fa-heartbeat"></i>
                    <h1 class="brand-title">Bizil Health Care</h1>
                    <p class="brand-subtitle">Complete your professional profile to start practicing</p>
                </div>
                
                <div class="brand-features">
                    <div class="feature-item">
                        <i class="fas fa-certificate"></i>
                        <span>Professional Verification</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-calendar-check"></i>
                        <span>Appointment Management</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-users"></i>
                        <span>Patient Management</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-chart-line"></i>
                        <span>Practice Analytics</span>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <!-- Flash Messages -->
                <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
                    <div class="alert alert-danger flash-message" role="alert">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <%= errorMessage %>
                    </div>
                <% } %>
                
                <% if (typeof successMessage !== 'undefined' && successMessage) { %>
                    <div class="alert alert-success flash-message" role="alert">
                        <i class="fas fa-check-circle me-2"></i>
                        <%= successMessage %>
                    </div>
                <% } %>
                
                <h2 class="form-title">Complete Your Professional Profile</h2>
                <p class="text-muted mb-4">Please provide your professional information for verification and patient services.</p>
                
                <form action="/doctor/complete-profile" method="post" class="needs-validation" novalidate id="profileForm">
                    <!-- Professional Information -->
                    <h5 class="mb-3"><i class="fas fa-id-card me-2"></i>Professional Information</h5>
                    
                    <div class="form-floating has-icon">
                        <span class="field-icon"><i class="fas fa-certificate"></i></span>
                        <input type="text" class="form-control" id="licenseNumber" name="licenseNumber" placeholder="Medical License Number" required minlength="5" maxlength="20" pattern="[A-Z0-9\-\/]+">
                        <label for="licenseNumber">Medical License Number</label>
                        <div class="invalid-feedback">Please enter a valid medical license number (5-20 characters, letters and numbers only).</div>
                        <div class="valid-feedback">License number format is correct!</div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-stethoscope"></i></span>
                            <select class="form-control" id="specialization" name="specialization" required>
                                <option value="">Select Specialization</option>
                                <option value="General Medicine">General Medicine</option>
                                <option value="Cardiology">Cardiology</option>
                                <option value="Neurology">Neurology</option>
                                <option value="Orthopedics">Orthopedics</option>
                                <option value="Pediatrics">Pediatrics</option>
                                <option value="Gynecology">Gynecology</option>
                                <option value="Dermatology">Dermatology</option>
                                <option value="Psychiatry">Psychiatry</option>
                                <option value="Ophthalmology">Ophthalmology</option>
                                <option value="ENT">ENT</option>
                                <option value="Radiology">Radiology</option>
                                <option value="Anesthesiology">Anesthesiology</option>
                                <option value="Emergency Medicine">Emergency Medicine</option>
                                <option value="Family Medicine">Family Medicine</option>
                                <option value="Internal Medicine">Internal Medicine</option>
                                <option value="Surgery">Surgery</option>
                                <option value="Oncology">Oncology</option>
                                <option value="Endocrinology">Endocrinology</option>
                                <option value="Nephrology">Nephrology</option>
                                <option value="Pulmonology">Pulmonology</option>
                                <option value="Gastroenterology">Gastroenterology</option>
                                <option value="Urology">Urology</option>
                                <option value="Rheumatology">Rheumatology</option>
                            </select>
                            <label for="specialization">Specialization</label>
                            <div class="invalid-feedback">Please select your specialization.</div>
                            <div class="valid-feedback">Specialization selected!</div>
                        </div>
                        
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-clock"></i></span>
                            <input type="number" class="form-control" id="experience" name="experience" placeholder="Years of Experience" required min="0" max="60">
                            <label for="experience">Years of Experience</label>
                            <div class="invalid-feedback">Please enter valid years of experience (0-60 years).</div>
                            <div class="valid-feedback">Experience years look good!</div>
                        </div>
                    </div>
                    
                    <div class="form-floating has-icon">
                        <span class="field-icon"><i class="fas fa-plus"></i></span>
                        <input type="text" class="form-control" id="subSpecialization" name="subSpecialization" placeholder="Sub-specialization (optional)">
                        <label for="subSpecialization">Sub-specialization (optional)</label>
                    </div>
                    
                    <!-- Education -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-graduation-cap me-2"></i>Education & Qualifications</h5>
                    
                    <div class="form-row">
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-certificate"></i></span>
                            <input type="text" class="form-control" id="degree" name="qualifications[0][degree]" placeholder="Primary Degree" required minlength="2" maxlength="50" pattern="[A-Za-z\s\.]+">
                            <label for="degree">Primary Medical Degree</label>
                            <div class="invalid-feedback">Please enter a valid medical degree (e.g., MBBS, MD, DO).</div>
                            <div class="valid-feedback">Degree looks good!</div>
                        </div>
                        
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-university"></i></span>
                            <input type="text" class="form-control" id="institution" name="qualifications[0][institution]" placeholder="Institution" required minlength="5" maxlength="100">
                            <label for="institution">Institution</label>
                            <div class="invalid-feedback">Please enter the full institution name (minimum 5 characters).</div>
                            <div class="valid-feedback">Institution name is valid!</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-calendar"></i></span>
                            <input type="number" class="form-control" id="year" name="qualifications[0][year]" placeholder="Graduation Year" required min="1950" max="2025">
                            <label for="year">Graduation Year</label>
                            <div class="invalid-feedback">Please enter a valid graduation year (1950-2025).</div>
                            <div class="valid-feedback">Graduation year is valid!</div>
                        </div>
                        
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-globe"></i></span>
                            <input type="text" class="form-control" id="country" name="qualifications[0][country]" value="India">
                            <label for="country">Country</label>
                        </div>
                    </div>
                    
                    <!-- Current Hospital/Practice -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-hospital me-2"></i>Current Practice</h5>
                    
                    <div class="form-floating has-icon">
                        <span class="field-icon"><i class="fas fa-building"></i></span>
                        <input type="text" class="form-control" id="hospitalName" name="currentHospital[name]" placeholder="Hospital/Clinic Name" required minlength="3" maxlength="100">
                        <label for="hospitalName">Hospital/Clinic Name</label>
                        <div class="invalid-feedback">Please enter your current workplace name (minimum 3 characters).</div>
                        <div class="valid-feedback">Hospital/clinic name looks good!</div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-sitemap"></i></span>
                            <input type="text" class="form-control" id="department" name="currentHospital[department]" placeholder="Department">
                            <label for="department">Department</label>
                        </div>
                        
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-user-tie"></i></span>
                            <input type="text" class="form-control" id="position" name="currentHospital[position]" placeholder="Position">
                            <label for="position">Position</label>
                        </div>
                    </div>
                    
                    <!-- Consultation Fees -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-rupee-sign me-2"></i>Consultation Fees</h5>
                    
                    <div class="form-row">
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-clinic-medical"></i></span>
                            <input type="number" class="form-control" id="inPersonFee" name="consultationFee[inPerson]" placeholder="In-Person Fee" required min="100" max="10000" step="50">
                            <label for="inPersonFee">In-Person Consultation (₹)</label>
                            <div class="invalid-feedback">Please enter a valid consultation fee (₹100 - ₹10,000).</div>
                            <div class="valid-feedback">Fee amount is valid!</div>
                        </div>
                        
                        <div class="form-floating has-icon">
                            <span class="field-icon"><i class="fas fa-video"></i></span>
                            <input type="number" class="form-control" id="onlineFee" name="consultationFee[online]" placeholder="Online Fee" min="50" max="5000" step="25">
                            <label for="onlineFee">Online Consultation (₹)</label>
                            <div class="invalid-feedback">Please enter a valid online fee (₹50 - ₹5,000).</div>
                            <div class="valid-feedback">Online fee looks good!</div>
                        </div>
                    </div>
                    
                    <div class="form-floating has-icon">
                        <span class="field-icon"><i class="fas fa-redo"></i></span>
                        <input type="number" class="form-control" id="followUpFee" name="consultationFee[followUp]" placeholder="Follow-up Fee" min="0">
                        <label for="followUpFee">Follow-up Consultation (₹)</label>
                    </div>
                    
                    <!-- Languages -->
                    <h5 class="mb-3 mt-4"><i class="fas fa-language me-2"></i>Languages Spoken</h5>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="lang-english" name="languages" value="English" checked>
                                <label class="form-check-label" for="lang-english">English</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="lang-hindi" name="languages" value="Hindi">
                                <label class="form-check-label" for="lang-hindi">Hindi</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="lang-telugu" name="languages" value="Telugu">
                                <label class="form-check-label" for="lang-telugu">Telugu</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="lang-tamil" name="languages" value="Tamil">
                                <label class="form-check-label" for="lang-tamil">Tamil</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="lang-bengali" name="languages" value="Bengali">
                                <label class="form-check-label" for="lang-bengali">Bengali</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="lang-marathi" name="languages" value="Marathi">
                                <label class="form-check-label" for="lang-marathi">Marathi</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="lang-gujarati" name="languages" value="Gujarati">
                                <label class="form-check-label" for="lang-gujarati">Gujarati</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="lang-other" name="languages" value="Other">
                                <label class="form-check-label" for="lang-other">Other</label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-signup mt-4">
                        <i class="fas fa-check me-2"></i>Complete Profile & Submit for Verification
                    </button>
                    
                    <button type="button" class="btn btn-outline-secondary w-100 mt-2" onclick="skipProfile()">
                        Skip for Now
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function skipProfile() {
            if (confirm('Are you sure you want to skip completing your professional profile? Your account will need verification before you can see patients.')) {
                window.location.href = '/dashboard';
            }
        }
        
        // Form validation
        document.getElementById('profileForm').addEventListener('submit', function(event) {
            if (!this.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
                // Focus on first invalid field
                const firstInvalid = this.querySelector('.form-control:invalid');
                if (firstInvalid) {
                    firstInvalid.focus();
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            this.classList.add('was-validated');
        });

        // Real-time validation
        document.querySelectorAll('.form-control').forEach(input => {
            let hasBeenTouched = false;
            
            input.addEventListener('focus', function() {
                hasBeenTouched = true;
            });
            
            input.addEventListener('blur', function() {
                if (hasBeenTouched) {
                    validateField(this);
                }
            });
            
            input.addEventListener('input', function() {
                if (hasBeenTouched) {
                    validateField(this);
                }
            });
        });

        function validateField(field) {
            // Custom validation rules
            switch(field.id) {
                case 'licenseNumber':
                    const licenseRegex = /^[A-Z0-9\-\/]{5,20}$/;
                    if (!licenseRegex.test(field.value.trim().toUpperCase())) {
                        field.setCustomValidity('License number must be 5-20 characters (uppercase letters, numbers, hyphens, slashes only)');
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
                    
                case 'experience':
                    const experience = parseInt(field.value);
                    if (isNaN(experience) || experience < 0 || experience > 60) {
                        field.setCustomValidity('Experience must be between 0 and 60 years');
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
                    
                case 'degree':
                    const degreeRegex = /^[A-Za-z\s\.]{2,50}$/;
                    if (!degreeRegex.test(field.value.trim())) {
                        field.setCustomValidity('Degree must contain only letters, spaces, and dots (2-50 characters)');
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
                    
                case 'institution':
                    if (field.value.trim().length < 5 || field.value.trim().length > 100) {
                        field.setCustomValidity('Institution name must be between 5 and 100 characters');
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
                    
                case 'year':
                    const currentYear = new Date().getFullYear();
                    const graduationYear = parseInt(field.value);
                    if (isNaN(graduationYear) || graduationYear < 1950 || graduationYear > currentYear + 1) {
                        field.setCustomValidity(`Graduation year must be between 1950 and ${currentYear + 1}`);
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
                    
                case 'hospitalName':
                    if (field.value.trim().length < 3 || field.value.trim().length > 100) {
                        field.setCustomValidity('Hospital/clinic name must be between 3 and 100 characters');
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
                    
                case 'inPersonFee':
                    const inPersonFee = parseInt(field.value);
                    if (isNaN(inPersonFee) || inPersonFee < 100 || inPersonFee > 10000) {
                        field.setCustomValidity('In-person consultation fee must be between ₹100 and ₹10,000');
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
                    
                case 'onlineFee':
                    if (field.value && field.value.trim() !== '') {
                        const onlineFee = parseInt(field.value);
                        if (isNaN(onlineFee) || onlineFee < 50 || onlineFee > 5000) {
                            field.setCustomValidity('Online consultation fee must be between ₹50 and ₹5,000');
                        } else {
                            field.setCustomValidity('');
                        }
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
                    
                case 'followUpFee':
                    if (field.value && field.value.trim() !== '') {
                        const followUpFee = parseInt(field.value);
                        if (isNaN(followUpFee) || followUpFee < 25 || followUpFee > 2500) {
                            field.setCustomValidity('Follow-up consultation fee must be between ₹25 and ₹2,500');
                        } else {
                            field.setCustomValidity('');
                        }
                    } else {
                        field.setCustomValidity('');
                    }
                    break;
            }
            
            // Update visual feedback
            if (field.checkValidity()) {
                field.classList.remove('is-invalid');
                field.classList.add('is-valid');
            } else {
                field.classList.remove('is-valid');
                field.classList.add('is-invalid');
            }
        }

        // License number formatting (uppercase)
        document.getElementById('licenseNumber').addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });

        // Ensure at least one language is selected
        function validateLanguages() {
            const languageCheckboxes = document.querySelectorAll('input[name="languages"]:checked');
            const languageSection = document.querySelector('input[name="languages"]').closest('.row');
            
            if (languageCheckboxes.length === 0) {
                languageSection.classList.add('is-invalid');
                return false;
            } else {
                languageSection.classList.remove('is-invalid');
                return true;
            }
        }

        // Add language validation to form submit
        document.getElementById('profileForm').addEventListener('submit', function(event) {
            if (!validateLanguages()) {
                event.preventDefault();
                event.stopPropagation();
                alert('Please select at least one language you speak.');
            }
        });
        
        // Auto-dismiss flash messages
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function(message) {
                setTimeout(function() {
                    message.style.transition = 'opacity 0.5s ease-out';
                    message.style.opacity = '0';
                    setTimeout(function() {
                        message.remove();
                    }, 500);
                }, 5000);
            });
        });
    </script>
</body>
</html>